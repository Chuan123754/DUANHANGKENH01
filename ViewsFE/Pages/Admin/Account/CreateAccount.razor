@page "/account/create"
@using ViewsFE.Models
@using ViewsFE.Helper
@inject HttpClient Http
@inject NavigationManager Navigation
@inject IAccountService accountService

<div class="container mt-5">
    <!-- Nút Quay Lại -->
    <div class="mb-3">
        <button class="btn btn-secondary" @onclick="GoBack">Back</button>
    </div>

    <div class="card" style="max-width: 600px; margin: auto;">
        <!-- Đặt chiều rộng tối đa cho card -->
        <div class="card-header">
            <h3 class="mb-0">Tạo Tài Khoản Mới</h3>
        </div>
        <div class="card-body">
            <EditForm Model="sigupModel" OnValidSubmit="HandleValidSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="mb-3">
                    <label>Tên:</label>
                    <InputText @bind-Value="sigupModel.FirstName" class="form-control" />
                    <ValidationMessage For="@(() => sigupModel.FirstName)" />
                </div>

                <div class="mb-3">
                    <label>Họ:</label>
                    <InputText @bind-Value="sigupModel.LastName" class="form-control" />
                    <ValidationMessage For="@(() => sigupModel.LastName)" />
                </div>

                <div class="mb-3">
                    <label>Email:</label>
                    <InputText @bind-Value="sigupModel.Email" class="form-control" type="email" />
                    <ValidationMessage For="@(() => sigupModel.Email)" />
                </div>

                <div class="mb-3">
                    <label>Mật khẩu:</label>
                    <InputText @bind-Value="sigupModel.Password" class="form-control" type="password" />
                    <ValidationMessage For="@(() => sigupModel.Password)" />
                </div>

                <div class="mb-3">
                    <label>Nhập lại mật khẩu:</label>
                    <InputText @bind-Value="sigupModel.ConfirmPassword" class="form-control" type="password" />
                    <ValidationMessage For="@(() => sigupModel.ConfirmPassword)" />
                </div>

                <div class="mb-3">
                    <label>Vai trò:</label>
                    <select @bind="sigupModel.Role" class="form-control">
                        <option value="">Chọn vai trò</option>
                        <option value="@ApplicationRole.Admin">Quản trị viên</option>
                        <option value="@ApplicationRole.Employee">Nhân viên</option>
                        <option value="@ApplicationRole.Designer">Nhà thiết kế</option>
                        <option value="@ApplicationRole.SuperAdmin">Quản trị viên cấp cao</option>
                        <option value="@ApplicationRole.Customer">Khách hàng</option>
                    </select>
                    <ValidationMessage For="@(() => sigupModel.Role)" />
                </div>

                <button type="submit" class="btn btn-primary">Tạo Tài Khoản</button>
            </EditForm>
        </div>
    </div>
</div>

@code {
    private SignUpModel sigupModel = new SignUpModel();

    private async Task HandleValidSubmit()
    {
        var identityResult = await accountService.SignUpAsync(sigupModel);
        if (identityResult.Succeeded)
        {
            Navigation.NavigateTo("/account/allaccount");
        }
        else
        {
            var errorMessages = identityResult.Errors.Select(error => error.Description);
            foreach (var errorMessage in errorMessages)
            {
                Console.WriteLine($"Lỗi: {errorMessage}");
            }
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/account/allaccount"); // Điều hướng trở lại trang danh sách tài khoản
    }
}
