@page "/admin/attribute/edit/{id:long}"
@inject IAttributesServices AttributeService
@inject NavigationManager NavigationManager

<h3>Chỉnh Sửa Thuộc Tính</h3>

<EditForm Model="attribute" OnValidSubmit="SubmitForm">
    <DataAnnotationsValidator></DataAnnotationsValidator>
    <ValidationSummary></ValidationSummary>

    <div class="form-group mb-3">
        <label for="attribute-title" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
        <InputText id="attribute-title" class="form-control" @bind-Value="attribute.Title" required />
        <ValidationMessage For="@(() => attribute.Title)" />
    </div>

    <div class="form-group mb-3">
        <label for="attribute-slug" class="form-label">Đường dẫn</label>
        <InputText id="attribute-slug" class="form-control" @bind-Value="attribute.Slug" />
        <small class="text-gray-100">“slug” là đường dẫn thân thiện của tên. Nó thường chỉ bao gồm kí tự viết thường, số và dấu gạch ngang, không dùng tiếng Việt.</small>
    </div>

    <div class="form-group mb-3">
        <label for="attribute_parent_id" class="form-label">Chuyên mục cha</label>
        <InputSelect id="attribute_parent_id" class="form-control" @bind-Value="attribute.Parent_Id">
            <option value="">Chọn danh mục cha</option>
            @if (attributesList != null && attributesList.Any())
            {
                @foreach (var attr in attributesList)
                {
                    <option value="@attr.Id">@attr.Title</option>
                }
            }
        </InputSelect>
    </div>

    <div class="form-group mb-3">
        <label for="attribute-color" class="form-label">Mã màu</label>
        <InputText id="attribute-color" class="form-control" @bind-Value="attribute.Color" />
    </div>

    <div class="form-group mb-3">
        <label for="attribute-template" class="form-label">Mẫu</label>
        <InputSelect id="attribute-template" class="form-control" @bind-Value="attribute.Template">
            <option value="default">Mặc định</option>
            <option value="color">Màu</option>
        </InputSelect>
    </div>

    <div class="form-group mb-3">
        <label for="attribute-in-order" class="form-label">Thứ tự</label>
        <InputNumber id="attribute-in-order" class="form-control" @bind-Value="attribute.In_Order" Min="0" />
    </div>

    <div class="form-group mb-3">
        <label for="attribute-description" class="form-label">Mô tả</label>
        <InputTextArea id="attribute-description" class="form-control" @bind-Value="attribute.Description" rows="3" />
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary">Cập nhật</button>
    </div>
</EditForm>

@code {
    [Parameter] public long id { get; set; }

    private Attributes attribute = new Attributes(); // Đảm bảo biến attribute đã được khởi tạo
    private List<Attributes> attributesList;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            attributesList = await AttributeService.GetAll();
            attribute = await AttributeService.GetById(id);

            if (attribute == null)
            {
                // Xử lý nếu không tìm thấy thuộc tính
                NavigationManager.NavigateTo("/admin/attribute");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Lỗi khi tải dữ liệu: {ex.Message}");
        }
    }

    private async Task SubmitForm()
    {
        try
        {
            await AttributeService.Update(attribute);
            NavigationManager.NavigateTo("/admin/attribute");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Lỗi: {ex.Message}");
        }
    }
}
